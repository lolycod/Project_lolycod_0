<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±Ÿæ¹–æƒ…ç¼˜ - è°ƒè¯•æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #444;
            border-radius: 5px;
            background: #2a2a2a;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196F3; }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover { background: #45a049; }
        pre {
            background: #333;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ æ±Ÿæ¹–æƒ…ç¼˜ç³»ç»Ÿè°ƒè¯•æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ è„šæœ¬åŠ è½½æ£€æŸ¥</h2>
        <div id="script-check"></div>
        <button onclick="checkScripts()">æ£€æŸ¥è„šæœ¬åŠ è½½</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“¸ å›¾ç‰‡æ•°æ®æ£€æŸ¥</h2>
        <div id="image-check"></div>
        <button onclick="checkImages()">æ£€æŸ¥å›¾ç‰‡æ•°æ®</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ”§ æ¨¡å—ç®¡ç†å™¨æ£€æŸ¥</h2>
        <div id="module-check"></div>
        <button onclick="checkModules()">æ£€æŸ¥æ¨¡å—çŠ¶æ€</button>
    </div>
    
    <div class="test-section">
        <h2>â° æ—¶é—´æ¨¡å—æµ‹è¯•</h2>
        <div id="time-check"></div>
        <button onclick="testTimeModule()">æµ‹è¯•æ—¶é—´æ¨¡å—</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ² ç›²ç›’åŠŸèƒ½æµ‹è¯•</h2>
        <div id="blindbox-check"></div>
        <button onclick="testBlindBox()">æµ‹è¯•ç›²ç›’åŠŸèƒ½</button>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬ -->
    <script src="config.js"></script>
    <script src="common-init.js"></script>
    <script src="module-manager.js"></script>

    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            element.appendChild(div);
        }

        function checkScripts() {
            const checkElement = document.getElementById('script-check');
            checkElement.innerHTML = '';
            
            const checks = [
                { name: 'USER_SIMPLE_CONFIG', obj: window.USER_SIMPLE_CONFIG },
                { name: 'WEBSITE_CONFIG', obj: window.WEBSITE_CONFIG },
                { name: 'generateImageData', obj: window.generateImageData },
                { name: 'moduleManager', obj: window.moduleManager },
                { name: 'initPageCommon', obj: window.initPageCommon },
                { name: 'syncUserSimpleConfig', obj: window.syncUserSimpleConfig }
            ];
            
            checks.forEach(check => {
                const status = check.obj ? 'âœ… å·²åŠ è½½' : 'âŒ æœªæ‰¾åˆ°';
                const type = check.obj ? 'success' : 'error';
                log('script-check', `${check.name}: ${status}`, type);
            });
        }

        function checkImages() {
            const checkElement = document.getElementById('image-check');
            checkElement.innerHTML = '';
            
            try {
                if (typeof generateImageData !== 'function') {
                    log('image-check', 'âŒ generateImageDataå‡½æ•°æœªæ‰¾åˆ°', 'error');
                    return;
                }
                
                const images = generateImageData();
                log('image-check', `âœ… æ‰¾åˆ° ${images.length} å¼ å›¾ç‰‡`, 'success');
                
                images.forEach((img, index) => {
                    log('image-check', `å›¾ç‰‡ ${index + 1}: ${img.src} - ${img.title}`, 'info');
                });
                
                // æ£€æŸ¥USER_SIMPLE_CONFIGä¸­çš„photos
                if (USER_SIMPLE_CONFIG && USER_SIMPLE_CONFIG.photos) {
                    log('image-check', `âœ… USER_SIMPLE_CONFIG.photos åŒ…å« ${USER_SIMPLE_CONFIG.photos.length} å¼ å›¾ç‰‡`, 'success');
                } else {
                    log('image-check', 'âŒ USER_SIMPLE_CONFIG.photos æœªæ‰¾åˆ°', 'error');
                }
                
            } catch (error) {
                log('image-check', `âŒ å›¾ç‰‡æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function checkModules() {
            const checkElement = document.getElementById('module-check');
            checkElement.innerHTML = '';
            
            try {
                if (typeof moduleManager === 'undefined') {
                    log('module-check', 'âŒ moduleManager æœªå®šä¹‰', 'error');
                    return;
                }
                
                const status = moduleManager.getAllModuleStates();
                log('module-check', 'âœ… æ¨¡å—ç®¡ç†å™¨å¯ç”¨', 'success');
                
                Object.keys(status).forEach(moduleName => {
                    const moduleStatus = status[moduleName];
                    const statusText = `${moduleName}: ${moduleStatus.state}`;
                    const type = moduleStatus.state === 'initialized' ? 'success' : 
                                moduleStatus.state === 'error' ? 'error' : 'warning';
                    log('module-check', statusText, type);
                });
                
            } catch (error) {
                log('module-check', `âŒ æ¨¡å—æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testTimeModule() {
            const checkElement = document.getElementById('time-check');
            checkElement.innerHTML = '';
            
            try {
                // æ£€æŸ¥TimeDisplayModuleç±»æ˜¯å¦å­˜åœ¨
                if (typeof TimeDisplayModule === 'undefined') {
                    log('time-check', 'âŒ TimeDisplayModule ç±»æœªå®šä¹‰', 'error');
                    return;
                }
                
                // å°è¯•åˆ›å»ºæ—¶é—´æ¨¡å—å®ä¾‹
                const timeModule = new TimeDisplayModule();
                const result = timeModule.init();
                
                if (result.success) {
                    log('time-check', 'âœ… æ—¶é—´æ¨¡å—åˆå§‹åŒ–æˆåŠŸ', 'success');
                    
                    // æµ‹è¯•è·å–æ—¶é—´ä¿¡æ¯
                    const timeInfo = timeModule.getCurrentTimeInfo();
                    if (timeInfo) {
                        log('time-check', `å½“å‰æ—¶é—´: ${timeInfo.formatted}`, 'info');
                    }
                } else {
                    log('time-check', `âŒ æ—¶é—´æ¨¡å—åˆå§‹åŒ–å¤±è´¥: ${result.error}`, 'error');
                }
                
            } catch (error) {
                log('time-check', `âŒ æ—¶é—´æ¨¡å—æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testBlindBox() {
            const checkElement = document.getElementById('blindbox-check');
            checkElement.innerHTML = '';
            
            try {
                // æ£€æŸ¥openBlindBoxå‡½æ•°æ˜¯å¦å­˜åœ¨
                if (typeof openBlindBox === 'undefined') {
                    log('blindbox-check', 'âŒ openBlindBox å‡½æ•°æœªå®šä¹‰', 'error');
                    log('blindbox-check', 'è¿™ä¸ªå‡½æ•°åº”è¯¥åœ¨index.htmlä¸­å®šä¹‰', 'warning');
                    return;
                }
                
                log('blindbox-check', 'âœ… openBlindBox å‡½æ•°å·²å®šä¹‰', 'success');
                
                // æ£€æŸ¥å›¾ç‰‡æ•°æ®
                const images = generateImageData();
                if (images && images.length > 0) {
                    log('blindbox-check', `âœ… ç›²ç›’æœ‰ ${images.length} å¼ å›¾ç‰‡å¯ç”¨`, 'success');
                } else {
                    log('blindbox-check', 'âŒ ç›²ç›’æ²¡æœ‰å¯ç”¨å›¾ç‰‡', 'error');
                }
                
            } catch (error) {
                log('blindbox-check', `âŒ ç›²ç›’åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                checkScripts();
                checkImages();
                checkModules();
            }, 1000);
        });
    </script>
</body>
</html>
